## ðŸš€ Introduction

1) Create Clerk.com account and add create application, copy api keys to project .env
2) Enable Billing settings in Clerk.com and setup Subscription plans - free, pro, advanced with prices 
3) Create supabase account, copy api keys to .env and upload sql query and policy
4) In supabase Configuration -> Sign In / Providers add Clerk url to auth verifying process

---

```sql
-- =========================================================
-- 0. Helper: get the requesting user's id from JWT
-- =========================================================
CREATE OR REPLACE FUNCTION requesting_user_id()
RETURNS text AS $$
  SELECT NULLIF(
    current_setting('request.jwt.claims', true)::json->>'sub',
    ''
  )::text;
$$ LANGUAGE SQL STABLE;

-- =========================================================
-- 1. Tables
-- =========================================================

-- Boards
CREATE TABLE IF NOT EXISTS public.boards (
  id          bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at  timestamptz NOT NULL DEFAULT now(),
  updated_at  timestamptz NOT NULL DEFAULT now(),
  title       text NOT NULL,
  description text,
  color       text,
  user_id     text NOT NULL
);

-- Columns
CREATE TABLE IF NOT EXISTS public.columns (
  id          bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at  timestamptz NOT NULL DEFAULT now(),
  board_id    bigint NOT NULL REFERENCES public.boards(id) ON DELETE CASCADE,
  title       text NOT NULL,
  sort_order  int4 NOT NULL DEFAULT 0,
  user_id     text NOT NULL
);

-- Tasks
CREATE TABLE IF NOT EXISTS public.tasks (
  id          bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at  timestamptz NOT NULL DEFAULT now(),
  title       text NOT NULL,
  description text,
  assignee    text,
  due_date    date,
  priority    text,
  sort_order  int4 NOT NULL DEFAULT 0,
  column_id   bigint NOT NULL REFERENCES public.columns(id) ON DELETE CASCADE
);

-- Optional: keep boards.updated_at fresh
CREATE OR REPLACE FUNCTION public.set_updated_at()
RETURNS trigger AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trg_boards_updated_at ON public.boards;
CREATE TRIGGER trg_boards_updated_at
BEFORE UPDATE ON public.boards
FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();

-- Helpful indexes
CREATE INDEX IF NOT EXISTS idx_columns_board_id ON public.columns(board_id);
CREATE INDEX IF NOT EXISTS idx_tasks_column_id  ON public.tasks(column_id);

-- =========================================================
-- 2. Enable Row Level Security
-- =========================================================
ALTER TABLE public.boards  ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.columns ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks   ENABLE ROW LEVEL SECURITY;

-- =========================================================
-- 3. Policies
-- =========================================================

--------------------------
-- BOARDS TABLE POLICIES
--------------------------

-- View own boards
CREATE POLICY "Users can view their own boards"
ON public.boards
FOR SELECT
USING (user_id = requesting_user_id()::text);

-- Insert own boards
CREATE POLICY "Users can insert their own boards"
ON public.boards
FOR INSERT
WITH CHECK (requesting_user_id() = user_id);

-- Update own boards
CREATE POLICY "Users can update their own boards"
ON public.boards
FOR UPDATE
USING (user_id = requesting_user_id())
WITH CHECK (user_id = requesting_user_id());

-- Delete own boards
CREATE POLICY "Users can delete their own boards"
ON public.boards
FOR DELETE
USING (user_id = requesting_user_id());

--------------------------
-- COLUMNS TABLE POLICIES
--------------------------

-- Users can view columns from their own boards
CREATE POLICY "Users can view columns from their own boards" ON public.columns
FOR SELECT USING (
  EXISTS (
    SELECT 1 FROM public.boards
    WHERE boards.id = columns.board_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can insert columns into their own boards
CREATE POLICY "Users can insert columns into their own boards" ON public.columns
FOR INSERT WITH CHECK (
  EXISTS (
    SELECT 1 FROM public.boards
    WHERE boards.id = columns.board_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can update columns from their own boards
CREATE POLICY "Users can update columns from their own boards" ON public.columns
FOR UPDATE USING (
  EXISTS (
    SELECT 1 FROM public.boards
    WHERE boards.id = columns.board_id
      AND boards.user_id = requesting_user_id()
  )
)
WITH CHECK (
  EXISTS (
    SELECT 1 FROM public.boards
    WHERE boards.id = columns.board_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can delete columns from their own boards
CREATE POLICY "Users can delete columns from their own boards" ON public.columns
FOR DELETE USING (
  EXISTS (
    SELECT 1 FROM public.boards
    WHERE boards.id = columns.board_id
      AND boards.user_id = requesting_user_id()
  )
);

-----------------------
-- TASKS TABLE POLICIES
-----------------------

-- Users can view tasks from their own boards
CREATE POLICY "Users can view tasks from their own boards" ON public.tasks
FOR SELECT USING (
  EXISTS (
    SELECT 1 FROM public.columns
    JOIN public.boards ON boards.id = columns.board_id
    WHERE columns.id = tasks.column_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can insert tasks into their own boards
CREATE POLICY "Users can insert tasks into their own boards" ON public.tasks
FOR INSERT WITH CHECK (
  EXISTS (
    SELECT 1 FROM public.columns
    JOIN public.boards ON boards.id = columns.board_id
    WHERE columns.id = tasks.column_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can update tasks from their own boards
CREATE POLICY "Users can update tasks from their own boards" ON public.tasks
FOR UPDATE USING (
  EXISTS (
    SELECT 1 FROM public.columns
    JOIN public.boards ON boards.id = columns.board_id
    WHERE columns.id = tasks.column_id
      AND boards.user_id = requesting_user_id()
  )
)
WITH CHECK (
  EXISTS (
    SELECT 1 FROM public.columns
    JOIN public.boards ON boards.id = columns.board_id
    WHERE columns.id = tasks.column_id
      AND boards.user_id = requesting_user_id()
  )
);

-- Users can delete tasks from their own boards
CREATE POLICY "Users can delete tasks from their own boards" ON public.tasks
FOR DELETE USING (
  EXISTS (
    SELECT 1 FROM public.columns
    JOIN public.boards ON boards.id = columns.board_id
    WHERE columns.id = tasks.column_id
      AND boards.user_id = requesting_user_id()
  )
);
```

### Clone and Run

## Getting Started

Install dependencies:

npm i @clerk/nextjs @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities @radix-ui/react-dialog @radix-ui/react-label @radix-ui/react-select @radix-ui/react-slot @supabase/ssr class-variance-authority clsx lucide-react tailwind-merge tw-animate-css

npx shadcn@latest init
npx shadcn add button card input label textarea dialog select badge

First, run the development server:

1. Copy `.env.example` to `.env.local` and fill in your Supabase & Clerk credentials.
2. Start local Supabase emulation (optional):

   ```bash
   supabase start
   supabase db push
   ```
3. Run the development server:

   ```bash
   npm run dev
   ```
4. Open [http://localhost:3000](http://localhost:3000) in your browser.